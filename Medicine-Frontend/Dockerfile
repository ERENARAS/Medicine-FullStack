# 1. AÅŸama: UygulamayÄ± Derleme (Build Stage)
FROM node:20-alpine AS build

WORKDIR /app

# BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
COPY package*.json ./
RUN npm install

# Proje dosyalarÄ±nÄ± kopyala
COPY . .

# ğŸ’¡ YENÄ°: Build argÃ¼manÄ±nÄ± al
ARG VITE_API_URL

# Build sÄ±rasÄ±nda VITE_API_URL'i env iÃ§ine enjekte et
# Bu sayede derlenmiÅŸ Vue kodunuz doÄŸru backend adresini kullanÄ±r
ENV VITE_API_URL=$VITE_API_URL

# UygulamayÄ± derle (API URL deÄŸiÅŸkeni artÄ±k eriÅŸilebilir)
# EÄŸer package.json'daki build komutunuz "vite build" ise Ã§alÄ±ÅŸacaktÄ±r.
RUN npm run build

# 2. AÅŸama: UygulamayÄ± Ã‡alÄ±ÅŸtÄ±rma (Run Stage)
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]